"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withConnectionAggregate = void 0;
const graphql_mongoose_loader_1 = require("@entria/graphql-mongoose-loader");
const buildAggregatePipeline_1 = require("./buildAggregatePipeline");
const withConnectionAggregate = (model, loader, condFn) => (...params) => {
    const { defaultConditions = {}, builtMongoConditions } = condFn(...params);
    const [context, args] = params;
    const aggregatePipeline = (0, buildAggregatePipeline_1.buildAggregatePipeline)({ defaultConditions, builtMongoConditions });
    const aggregate = model.aggregate(aggregatePipeline);
    return (0, graphql_mongoose_loader_1.connectionFromMongoAggregate)({
        aggregate,
        context,
        args,
        loader: loader,
    });
};
exports.withConnectionAggregate = withConnectionAggregate;
//# sourceMappingURL=withConnectionAggregate.js.map